/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Injectable, QueryList } from "@angular/core";
import { DynamicFormArrayGroupModel } from "../model/form-array/dynamic-form-array.model";
import { DYNAMIC_TEMPLATE_DIRECTIVE_ALIGNMENT } from "../directive/dynamic-template.directive";
import { isObject } from "../utils/core.utils";
import * as i0 from "@angular/core";
var DynamicFormLayoutService = /** @class */ (function () {
    function DynamicFormLayoutService() {
    }
    /**
     * @param {?} id
     * @param {?} formLayout
     * @return {?}
     */
    DynamicFormLayoutService.prototype.findById = /**
     * @param {?} id
     * @param {?} formLayout
     * @return {?}
     */
    function (id, formLayout) {
        var e_1, _a;
        if (isObject(formLayout)) {
            try {
                for (var _b = tslib_1.__values(Object.keys(formLayout)), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var key = _c.value;
                    if (key === id) {
                        return formLayout[key];
                    }
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_1) throw e_1.error; }
            }
        }
        return null;
    };
    /**
     * @param {?} model
     * @param {?} formLayout
     * @return {?}
     */
    DynamicFormLayoutService.prototype.findByModel = /**
     * @param {?} model
     * @param {?} formLayout
     * @return {?}
     */
    function (model, formLayout) {
        var e_2, _a;
        /** @type {?} */
        var controlLayout = null;
        if (isObject(formLayout)) {
            var _loop_1 = function (key) {
                key.split(",").forEach((/**
                 * @param {?} substring
                 * @return {?}
                 */
                function (substring) {
                    /** @type {?} */
                    var selector = substring.trim();
                    if (selector === model.id || selector === model.type) {
                        controlLayout = formLayout[key];
                    }
                }));
            };
            try {
                for (var _b = tslib_1.__values(Object.keys(formLayout)), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var key = _c.value;
                    _loop_1(key);
                }
            }
            catch (e_2_1) { e_2 = { error: e_2_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_2) throw e_2.error; }
            }
        }
        return controlLayout;
    };
    /**
     * @param {?} model
     * @param {?} templates
     * @return {?}
     */
    DynamicFormLayoutService.prototype.filterTemplatesByModel = /**
     * @param {?} model
     * @param {?} templates
     * @return {?}
     */
    function (model, templates) {
        /** @type {?} */
        var filterCallback = (/**
         * @param {?} template
         * @return {?}
         */
        function (template) {
            return template.modelId === model.id || template.modelType === model.type;
        });
        if (templates instanceof QueryList) {
            return templates.filter(filterCallback);
        }
        else if (Array.isArray(templates)) {
            return templates.filter(filterCallback);
        }
        return [];
    };
    /**
     * @param {?} model
     * @param {?} templates
     * @param {?} alignment
     * @return {?}
     */
    DynamicFormLayoutService.prototype.getAlignedTemplate = /**
     * @param {?} model
     * @param {?} templates
     * @param {?} alignment
     * @return {?}
     */
    function (model, templates, alignment) {
        return this.filterTemplatesByModel(model, templates)
            .find((/**
         * @param {?} template
         * @return {?}
         */
        function (template) { return template.as === null && template.align === alignment; }));
    };
    /*
    getIndexedTemplates(model: DynamicFormControlModel, templates: DynamicFormControlTemplates): DynamicTemplateDirective[] | undefined {
        return this.filterTemplatesByModel(model, templates).filter(template => template.as === null);
    }
    */
    /*
        getIndexedTemplates(model: DynamicFormControlModel, templates: DynamicFormControlTemplates): DynamicTemplateDirective[] | undefined {
            return this.filterTemplatesByModel(model, templates).filter(template => template.as === null);
        }
        */
    /**
     * @param {?} model
     * @param {?} templates
     * @return {?}
     */
    DynamicFormLayoutService.prototype.getStartTemplate = /*
        getIndexedTemplates(model: DynamicFormControlModel, templates: DynamicFormControlTemplates): DynamicTemplateDirective[] | undefined {
            return this.filterTemplatesByModel(model, templates).filter(template => template.as === null);
        }
        */
    /**
     * @param {?} model
     * @param {?} templates
     * @return {?}
     */
    function (model, templates) {
        return this.getAlignedTemplate(model, templates, DYNAMIC_TEMPLATE_DIRECTIVE_ALIGNMENT.Start);
    };
    /**
     * @param {?} model
     * @param {?} templates
     * @return {?}
     */
    DynamicFormLayoutService.prototype.getEndTemplate = /**
     * @param {?} model
     * @param {?} templates
     * @return {?}
     */
    function (model, templates) {
        return this.getAlignedTemplate(model, templates, DYNAMIC_TEMPLATE_DIRECTIVE_ALIGNMENT.End);
    };
    /**
     * @param {?} layout
     * @param {?} context
     * @param {?} place
     * @return {?}
     */
    DynamicFormLayoutService.prototype.getClass = /**
     * @param {?} layout
     * @param {?} context
     * @param {?} place
     * @return {?}
     */
    function (layout, context, place) {
        if (layout !== null && layout.hasOwnProperty(context)) {
            /** @type {?} */
            var config = (/** @type {?} */ (layout[context]));
            if (config.hasOwnProperty(place)) {
                return (/** @type {?} */ (config[place]));
            }
        }
        return "";
    };
    /**
     * @param {?} model
     * @return {?}
     */
    DynamicFormLayoutService.prototype.getElementId = /**
     * @param {?} model
     * @return {?}
     */
    function (model) {
        /** @type {?} */
        var id = model.id;
        /** @type {?} */
        var parent = model.parent;
        while (parent !== null) {
            if (parent instanceof DynamicFormArrayGroupModel) {
                id = parent.context.id + "-" + parent.index + "-" + model.id;
                break;
            }
            parent = parent.parent;
        }
        return id;
    };
    DynamicFormLayoutService.decorators = [
        { type: Injectable, args: [{
                    providedIn: "root"
                },] }
    ];
    /** @nocollapse */ DynamicFormLayoutService.ngInjectableDef = i0.ɵɵdefineInjectable({ factory: function DynamicFormLayoutService_Factory() { return new DynamicFormLayoutService(); }, token: DynamicFormLayoutService, providedIn: "root" });
    return DynamicFormLayoutService;
}());
export { DynamicFormLayoutService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHluYW1pYy1mb3JtLWxheW91dC5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQG5nLWR5bmFtaWMtZm9ybXMvY29yZS8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlL2R5bmFtaWMtZm9ybS1sYXlvdXQuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBUXRELE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxNQUFNLDhDQUE4QyxDQUFDO0FBQzFGLE9BQU8sRUFFSCxvQ0FBb0MsRUFDdkMsTUFBTSx5Q0FBeUMsQ0FBQztBQUNqRCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0scUJBQXFCLENBQUM7O0FBTS9DO0lBQUE7S0E0R0M7Ozs7OztJQXZHRywyQ0FBUTs7Ozs7SUFBUixVQUFTLEVBQVUsRUFBRSxVQUFvQzs7UUFFckQsSUFBSSxRQUFRLENBQUMsVUFBVSxDQUFDLEVBQUU7O2dCQUV0QixLQUFnQixJQUFBLEtBQUEsaUJBQUEsTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQSxnQkFBQSw0QkFBRTtvQkFBcEMsSUFBSSxHQUFHLFdBQUE7b0JBRVIsSUFBSSxHQUFHLEtBQUssRUFBRSxFQUFFO3dCQUNaLE9BQU8sVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDO3FCQUMxQjtpQkFDSjs7Ozs7Ozs7O1NBQ0o7UUFFRCxPQUFPLElBQUksQ0FBQztJQUNoQixDQUFDOzs7Ozs7SUFFRCw4Q0FBVzs7Ozs7SUFBWCxVQUFZLEtBQThCLEVBQUUsVUFBb0M7OztZQUV4RSxhQUFhLEdBQTZCLElBQUk7UUFFbEQsSUFBSSxRQUFRLENBQUMsVUFBVSxDQUFDLEVBQUU7b0NBRWIsR0FBRztnQkFFUixHQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLE9BQU87Ozs7Z0JBQUMsVUFBQSxTQUFTOzt3QkFFdEIsUUFBUSxHQUFHLFNBQVMsQ0FB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RUFBSSxDQUFDO2dCQUN4RCxNQUFNO2FBQ1Q7WUFFRCxNQUFNLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQztTQUMxQjtRQUVELE9BQU8sRUFBRSxDQUFDO0lBQ2QsQ0FBQzs7Z0JBM0dKLFVBQVUsU0FBQztvQkFDUixVQUFVLEVBQUUsTUFBTTtpQkFDckI7OzttQ0FyQkQ7Q0ErSEMsQUE1R0QsSUE0R0M7U0F6R1ksd0JBQXdCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgUXVlcnlMaXN0IH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7XG4gICAgRHluYW1pY0Zvcm1Db250cm9sTGF5b3V0LFxuICAgIER5bmFtaWNGb3JtQ29udHJvbExheW91dENvbmZpZyxcbiAgICBEeW5hbWljRm9ybUNvbnRyb2xMYXlvdXRDb250ZXh0LFxuICAgIER5bmFtaWNGb3JtQ29udHJvbExheW91dFBsYWNlXG59IGZyb20gXCIuLi9tb2RlbC9taXNjL2R5bmFtaWMtZm9ybS1jb250cm9sLWxheW91dC5tb2RlbFwiO1xuaW1wb3J0IHsgRHluYW1pY0Zvcm1Db250cm9sTW9kZWwgfSBmcm9tIFwiLi4vbW9kZWwvZHluYW1pYy1mb3JtLWNvbnRyb2wubW9kZWxcIjtcbmltcG9ydCB7IER5bmFtaWNGb3JtQXJyYXlHcm91cE1vZGVsIH0gZnJvbSBcIi4uL21vZGVsL2Zvcm0tYXJyYXkvZHluYW1pYy1mb3JtLWFycmF5Lm1vZGVsXCI7XG5pbXBvcnQge1xuICAgIER5bmFtaWNUZW1wbGF0ZURpcmVjdGl2ZSxcbiAgICBEWU5BTUlDX1RFTVBMQVRFX0RJUkVDVElWRV9BTElHTk1FTlRcbn0gZnJvbSBcIi4uL2RpcmVjdGl2ZS9keW5hbWljLXRlbXBsYXRlLmRpcmVjdGl2ZVwiO1xuaW1wb3J0IHsgaXNPYmplY3QgfSBmcm9tIFwiLi4vdXRpbHMvY29yZS51dGlsc1wiO1xuXG5leHBvcnQgdHlwZSBEeW5hbWljRm9ybUxheW91dCA9IHsgW2lkOiBzdHJpbmddOiBEeW5hbWljRm9ybUNvbnRyb2xMYXlvdXQgfTtcblxuZXhwb3J0IHR5cGUgRHluYW1pY0Zvcm1Db250cm9sVGVtcGxhdGVzID0gUXVlcnlMaXN0PER5bmFtaWNUZW1wbGF0ZURpcmVjdGl2ZT4gfCBEeW5hbWljVGVtcGxhdGVEaXJlY3RpdmVbXSB8IHVuZGVmaW5lZDtcblxuQEluamVjdGFibGUoe1xuICAgIHByb3ZpZGVkSW46IFwicm9vdFwiXG59KVxuZXhwb3J0IGNsYXNzIER5bmFtaWNGb3JtTGF5b3V0U2VydmljZSB7XG5cbiAgICBmaW5kQnlJZChpZDogc3RyaW5nLCBmb3JtTGF5b3V0OiBEeW5hbWljRm9ybUxheW91dCB8IG51bGwpOiBEeW5hbWljRm9ybUNvbnRyb2xMYXlvdXQgfCBudWxsIHtcblxuICAgICAgICBpZiAoaXNPYmplY3QoZm9ybUxheW91dCkpIHtcblxuICAgICAgICAgICAgZm9yIChsZXQga2V5IG9mIE9iamVjdC5rZXlzKGZvcm1MYXlvdXQpKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoa2V5ID09PSBpZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZm9ybUxheW91dFtrZXldO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGZpbmRCeU1vZGVsKG1vZGVsOiBEeW5hbWljRm9ybUNvbnRyb2xNb2RlbCwgZm9ybUxheW91dDogRHluYW1pY0Zvcm1MYXlvdXQgfCBudWxsKTogRHluYW1pY0Zvcm1Db250cm9sTGF5b3V0IHwgbnVsbCB7XG5cbiAgICAgICAgbGV0IGNvbnRyb2xMYXlvdXQ6IER5bmFtaWNGb3JtQ29udHJvbExheW91dCA9IG51bGw7XG5cbiAgICAgICAgaWYgKGlzT2JqZWN0KGZvcm1MYXlvdXQpKSB7XG5cbiAgICAgICAgICAgIGZvciAobGV0IGtleSBvZiBPYmplY3Qua2V5cyhmb3JtTGF5b3V0KSkge1xuXG4gICAgICAgICAgICAgICAga2V5LnNwbGl0KFwiLFwiKS5mb3JFYWNoKHN1YnN0cmluZyA9PiB7XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0b3IgPSBzdWJzdHJpbmcudHJpbSgpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChzZWxlY3RvciA9PT0gbW9kZWwuaWQgfHwgc2VsZWN0b3IgPT09IG1vZGVsLnR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xMYXlvdXQgPSBmb3JtTGF5b3V0W2tleV07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBjb250cm9sTGF5b3V0O1xuICAgIH1cblxuICAgIGZpbHRlclRlbXBsYXRlc0J5TW9kZWwobW9kZWw6IER5bmFtaWNGb3JtQ29udHJvbE1vZGVsLCB0ZW1wbGF0ZXM6IER5bmFtaWNGb3JtQ29udHJvbFRlbXBsYXRlcyk6IER5bmFtaWNUZW1wbGF0ZURpcmVjdGl2ZVtdIHtcblxuICAgICAgICBjb25zdCBmaWx0ZXJDYWxsYmFjazogKHRlbXBsYXRlOiBEeW5hbWljVGVtcGxhdGVEaXJlY3RpdmUpID0+IGJvb2xlYW4gPSAodGVtcGxhdGU6IER5bmFtaWNUZW1wbGF0ZURpcmVjdGl2ZSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHRlbXBsYXRlLm1vZGVsSWQgPT09IG1vZGVsLmlkIHx8IHRlbXBsYXRlLm1vZGVsVHlwZSA9PT0gbW9kZWwudHlwZTtcbiAgICAgICAgfTtcblxuICAgICAgICBpZiAodGVtcGxhdGVzIGluc3RhbmNlb2YgUXVlcnlMaXN0KSB7XG4gICAgICAgICAgICByZXR1cm4gdGVtcGxhdGVzLmZpbHRlcihmaWx0ZXJDYWxsYmFjayk7XG5cbiAgICAgICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KHRlbXBsYXRlcykpIHtcbiAgICAgICAgICAgIHJldHVybiB0ZW1wbGF0ZXMuZmlsdGVyKGZpbHRlckNhbGxiYWNrKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG5cbiAgICBnZXRBbGlnbmVkVGVtcGxhdGUobW9kZWw6IER5bmFtaWNGb3JtQ29udHJvbE1vZGVsLCB0ZW1wbGF0ZXM6IER5bmFtaWNGb3JtQ29udHJvbFRlbXBsYXRlcywgYWxpZ25tZW50OiBEWU5BTUlDX1RFTVBMQVRFX0RJUkVDVElWRV9BTElHTk1FTlQpOiBEeW5hbWljVGVtcGxhdGVEaXJlY3RpdmUgfCB1bmRlZmluZWQge1xuXG4gICAgICAgIHJldHVybiB0aGlzLmZpbHRlclRlbXBsYXRlc0J5TW9kZWwobW9kZWwsIHRlbXBsYXRlcylcbiAgICAgICAgICAgIC5maW5kKHRlbXBsYXRlID0+IHRlbXBsYXRlLmFzID09PSBudWxsICYmIHRlbXBsYXRlLmFsaWduID09PSBhbGlnbm1lbnQpO1xuICAgIH1cblxuICAgIC8qXG4gICAgZ2V0SW5kZXhlZFRlbXBsYXRlcyhtb2RlbDogRHluYW1pY0Zvcm1Db250cm9sTW9kZWwsIHRlbXBsYXRlczogRHluYW1pY0Zvcm1Db250cm9sVGVtcGxhdGVzKTogRHluYW1pY1RlbXBsYXRlRGlyZWN0aXZlW10gfCB1bmRlZmluZWQge1xuICAgICAgICByZXR1cm4gdGhpcy5maWx0ZXJUZW1wbGF0ZXNCeU1vZGVsKG1vZGVsLCB0ZW1wbGF0ZXMpLmZpbHRlcih0ZW1wbGF0ZSA9PiB0ZW1wbGF0ZS5hcyA9PT0gbnVsbCk7XG4gICAgfVxuICAgICovXG4gICAgZ2V0U3RhcnRUZW1wbGF0ZShtb2RlbDogRHluYW1pY0Zvcm1Db250cm9sTW9kZWwsIHRlbXBsYXRlczogRHluYW1pY0Zvcm1Db250cm9sVGVtcGxhdGVzKTogRHluYW1pY1RlbXBsYXRlRGlyZWN0aXZlIHwgdW5kZWZpbmVkIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QWxpZ25lZFRlbXBsYXRlKG1vZGVsLCB0ZW1wbGF0ZXMsIERZTkFNSUNfVEVNUExBVEVfRElSRUNUSVZFX0FMSUdOTUVOVC5TdGFydCk7XG4gICAgfVxuXG4gICAgZ2V0RW5kVGVtcGxhdGUobW9kZWw6IER5bmFtaWNGb3JtQ29udHJvbE1vZGVsLCB0ZW1wbGF0ZXM6IER5bmFtaWNGb3JtQ29udHJvbFRlbXBsYXRlcyk6IER5bmFtaWNUZW1wbGF0ZURpcmVjdGl2ZSB8IHVuZGVmaW5lZCB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldEFsaWduZWRUZW1wbGF0ZShtb2RlbCwgdGVtcGxhdGVzLCBEWU5BTUlDX1RFTVBMQVRFX0RJUkVDVElWRV9BTElHTk1FTlQuRW5kKTtcbiAgICB9XG5cbiAgICBnZXRDbGFzcyhsYXlvdXQ6IER5bmFtaWNGb3JtQ29udHJvbExheW91dCB8IG51bGwsIGNvbnRleHQ6IER5bmFtaWNGb3JtQ29udHJvbExheW91dENvbnRleHQsIHBsYWNlOiBEeW5hbWljRm9ybUNvbnRyb2xMYXlvdXRQbGFjZSk6IHN0cmluZyB7XG5cbiAgICAgICAgaWYgKGxheW91dCAhPT0gbnVsbCAmJiBsYXlvdXQuaGFzT3duUHJvcGVydHkoY29udGV4dCkpIHtcblxuICAgICAgICAgICAgbGV0IGNvbmZpZyA9IGxheW91dFtjb250ZXh0XSBhcyBEeW5hbWljRm9ybUNvbnRyb2xMYXlvdXRDb25maWc7XG5cbiAgICAgICAgICAgIGlmIChjb25maWcuaGFzT3duUHJvcGVydHkocGxhY2UpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpZ1twbGFjZV0gYXMgc3RyaW5nO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgfVxuXG4gICAgZ2V0RWxlbWVudElkKG1vZGVsOiBEeW5hbWljRm9ybUNvbnRyb2xNb2RlbCk6IHN0cmluZyB7XG5cbiAgICAgICAgbGV0IGlkID0gbW9kZWwuaWQsIHBhcmVudCA9IG1vZGVsLnBhcmVudDtcblxuICAgICAgICB3aGlsZSAocGFyZW50ICE9PSBudWxsKSB7XG5cbiAgICAgICAgICAgIGlmIChwYXJlbnQgaW5zdGFuY2VvZiBEeW5hbWljRm9ybUFycmF5R3JvdXBNb2RlbCkge1xuXG4gICAgICAgICAgICAgICAgaWQgPSBgJHtwYXJlbnQuY29udGV4dC5pZH0tJHtwYXJlbnQuaW5kZXh9LSR7bW9kZWwuaWR9YDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcGFyZW50ID0gcGFyZW50LnBhcmVudDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBpZDtcbiAgICB9XG59XG4iXX0=