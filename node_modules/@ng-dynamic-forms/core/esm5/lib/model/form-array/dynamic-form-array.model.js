/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { DynamicFormControlModel } from "../dynamic-form-control.model";
import { serializable, serialize } from "../../decorator/serializable.decorator";
import { isFunction, isNumber } from "../../utils/core.utils";
var DynamicFormArrayGroupModel = /** @class */ (function () {
    function DynamicFormArrayGroupModel(context, group, index) {
        if (group === void 0) { group = []; }
        if (index === void 0) { index = -1; }
        this.$implicit = this;
        this.context = context;
        this.group = group;
        this.index = index;
    }
    Object.defineProperty(DynamicFormArrayGroupModel.prototype, "parent", {
        get: /**
         * @return {?}
         */
        function () {
            return this.context;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} index
     * @return {?}
     */
    DynamicFormArrayGroupModel.prototype.get = /**
     * @param {?} index
     * @return {?}
     */
    function (index) {
        return this.group[index];
    };
    /**
     * @return {?}
     */
    DynamicFormArrayGroupModel.prototype.toJSON = /**
     * @return {?}
     */
    function () {
        return serialize(this);
    };
    tslib_1.__decorate([
        serializable(),
        tslib_1.__metadata("design:type", Array)
    ], DynamicFormArrayGroupModel.prototype, "group", void 0);
    tslib_1.__decorate([
        serializable(),
        tslib_1.__metadata("design:type", Number)
    ], DynamicFormArrayGroupModel.prototype, "index", void 0);
    return DynamicFormArrayGroupModel;
}());
export { DynamicFormArrayGroupModel };
if (false) {
    /** @type {?} */
    DynamicFormArrayGroupModel.prototype.$implicit;
    /** @type {?} */
    DynamicFormArrayGroupModel.prototype.context;
    /** @type {?} */
    DynamicFormArrayGroupModel.prototype.group;
    /** @type {?} */
    DynamicFormArrayGroupModel.prototype.index;
}
/** @type {?} */
export var DYNAMIC_FORM_CONTROL_TYPE_ARRAY = "ARRAY";
/**
 * @record
 */
export function DynamicFormArrayModelConfig() { }
if (false) {
    /** @type {?|undefined} */
    DynamicFormArrayModelConfig.prototype.groupAsyncValidators;
    /** @type {?|undefined} */
    DynamicFormArrayModelConfig.prototype.groupFactory;
    /** @type {?|undefined} */
    DynamicFormArrayModelConfig.prototype.groupValidators;
    /** @type {?|undefined} */
    DynamicFormArrayModelConfig.prototype.groups;
    /** @type {?|undefined} */
    DynamicFormArrayModelConfig.prototype.initialCount;
}
var DynamicFormArrayModel = /** @class */ (function (_super) {
    tslib_1.__extends(DynamicFormArrayModel, _super);
    function DynamicFormArrayModel(config, layout) {
        var _this = _super.call(this, config, layout) || this;
        _this.groups = [];
        // only to recreate model from JSON
        _this.type = DYNAMIC_FORM_CONTROL_TYPE_ARRAY;
        if (isFunction(config.groupFactory)) {
            _this.groupFactory = config.groupFactory;
        }
        else {
            throw new Error("group factory function must be specified for DynamicFormArrayModel");
        }
        _this.groupAsyncValidators = config.groupAsyncValidators || null;
        _this.groupPrototype = _this.groupFactory();
        _this.groupValidators = config.groupValidators || null;
        _this.initialCount = isNumber(config.initialCount) ? config.initialCount : 1;
        if (Array.isArray(config.groups)) {
            config.groups.forEach((/**
             * @param {?} arrayGroup
             * @param {?} index
             * @return {?}
             */
            function (arrayGroup, index) {
                _this.groups.push(new DynamicFormArrayGroupModel(_this, arrayGroup.group, arrayGroup.index || index));
            }));
        }
        else {
            for (var index = 0; index < _this.initialCount; index++) {
                _this.addGroup();
            }
        }
        return _this;
    }
    /**
     * @private
     * @return {?}
     */
    DynamicFormArrayModel.prototype.updateGroupIndex = /**
     * @private
     * @return {?}
     */
    function () {
        this.groups.forEach((/**
         * @param {?} group
         * @param {?} index
         * @return {?}
         */
        function (group, index) { return group.index = index; }));
    };
    Object.defineProperty(DynamicFormArrayModel.prototype, "size", {
        get: /**
         * @return {?}
         */
        function () {
            return this.groups.length;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} index
     * @return {?}
     */
    DynamicFormArrayModel.prototype.get = /**
     * @param {?} index
     * @return {?}
     */
    function (index) {
        return this.groups[index];
    };
    /**
     * @return {?}
     */
    DynamicFormArrayModel.prototype.addGroup = /**
     * @return {?}
     */
    function () {
        return this.insertGroup(this.groups.length);
    };
    /**
     * @param {?} index
     * @return {?}
     */
    DynamicFormArrayModel.prototype.insertGroup = /**
     * @param {?} index
     * @return {?}
     */
    function (index) {
        /** @type {?} */
        var group = new DynamicFormArrayGroupModel(this, this.groupFactory());
        this.groups.splice(index, 0, group);
        this.updateGroupIndex();
        return group;
    };
    /**
     * @param {?} index
     * @param {?} step
     * @return {?}
     */
    DynamicFormArrayModel.prototype.moveGroup = /**
     * @param {?} index
     * @param {?} step
     * @return {?}
     */
    function (index, step) {
        var _a;
        (_a = this.groups).splice.apply(_a, tslib_1.__spread([index + step, 0], this.groups.splice(index, 1)));
        this.updateGroupIndex();
    };
    /**
     * @param {?} index
     * @return {?}
     */
    DynamicFormArrayModel.prototype.removeGroup = /**
     * @param {?} index
     * @return {?}
     */
    function (index) {
        this.groups.splice(index, 1);
        this.updateGroupIndex();
    };
    /**
     * @return {?}
     */
    DynamicFormArrayModel.prototype.clear = /**
     * @return {?}
     */
    function () {
        this.groups.splice(0);
        this.updateGroupIndex();
    };
    tslib_1.__decorate([
        serializable(),
        tslib_1.__metadata("design:type", Object)
    ], DynamicFormArrayModel.prototype, "groupAsyncValidators", void 0);
    tslib_1.__decorate([
        serializable(),
        tslib_1.__metadata("design:type", Object)
    ], DynamicFormArrayModel.prototype, "groupValidators", void 0);
    tslib_1.__decorate([
        serializable(),
        tslib_1.__metadata("design:type", Array)
    ], DynamicFormArrayModel.prototype, "groups", void 0);
    tslib_1.__decorate([
        serializable(),
        tslib_1.__metadata("design:type", Number)
    ], DynamicFormArrayModel.prototype, "initialCount", void 0);
    tslib_1.__decorate([
        serializable(),
        tslib_1.__metadata("design:type", Array)
    ], DynamicFormArrayModel.prototype, "groupPrototype", void 0);
    tslib_1.__decorate([
        serializable(),
        tslib_1.__metadata("design:type", String)
    ], DynamicFormArrayModel.prototype, "type", void 0);
    return DynamicFormArrayModel;
}(DynamicFormControlModel));
export { DynamicFormArrayModel };
if (false) {
    /** @type {?} */
    DynamicFormArrayModel.prototype.groupAsyncValidators;
    /** @type {?} */
    DynamicFormArrayModel.prototype.groupFactory;
    /** @type {?} */
    DynamicFormArrayModel.prototype.groupValidators;
    /** @type {?} */
    DynamicFormArrayModel.prototype.groups;
    /** @type {?} */
    DynamicFormArrayModel.prototype.initialCount;
    /** @type {?} */
    DynamicFormArrayModel.prototype.groupPrototype;
    /** @type {?} */
    DynamicFormArrayModel.prototype.type;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHluYW1pYy1mb3JtLWFycmF5Lm1vZGVsLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQG5nLWR5bmFtaWMtZm9ybXMvY29yZS8iLCJzb3VyY2VzIjpbImxpYi9tb2RlbC9mb3JtLWFycmF5L2R5bmFtaWMtZm9ybS1hcnJheS5tb2RlbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSx1QkFBdUIsRUFBaUMsTUFBTSwrQkFBK0IsQ0FBQztBQUt2RyxPQUFPLEVBQUUsWUFBWSxFQUFFLFNBQVMsRUFBRSxNQUFNLHdDQUF3QyxDQUFDO0FBQ2pGLE9BQU8sRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFFOUQ7SUFPSSxvQ0FBWSxPQUE4QixFQUFFLEtBQTRCLEVBQUUsS0FBa0I7UUFBaEQsc0JBQUEsRUFBQSxVQUE0QjtRQUFFLHNCQUFBLEVBQUEsU0FBaUIsQ0FBQztRQUV4RixJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQztRQUN0QixJQUFJLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztRQUN2QixJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztRQUNuQixJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztJQUN2QixDQUFDO0lBRUQsc0JBQUksOENBQU07Ozs7UUFBVjtZQUNJLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQztRQUN4QixDQUFDOzs7T0FBQTs7Ozs7SUFFRCx3Q0FBRzs7OztJQUFILFVBQUksS0FBYTtRQUNiLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUM3QixDQUFDOzs7O0lBRUQsMkNBQU07OztJQUFOO1FBQ0ksT0FBTyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDM0IsQ0FBQztJQXJCZTtRQUFmLFlBQVksRUFBRTs7NkRBQXlCO0lBQ3hCO1FBQWYsWUFBWSxFQUFFOzs2REFBZTtJQXFCbEMsaUNBQUM7Q0FBQSxBQTFCRCxJQTBC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bmFtaWNGb3JtQ29udHJvbE1vZGVsQ29uZmlnIH0gZnJvbSBcIi4uL2R5bmFtaWMtZm9ybS1jb250cm9sLm1vZGVsXCI7XG5pbXBvcnQgeyBEeW5hbWljRm9ybU1vZGVsIH0gZnJvbSBcIi4uL2R5bmFtaWMtZm9ybS5tb2RlbFwiO1xuaW1wb3J0IHsgRHluYW1pY0Zvcm1Db250cm9sTGF5b3V0IH0gZnJvbSBcIi4uL21pc2MvZHluYW1pYy1mb3JtLWNvbnRyb2wtbGF5b3V0Lm1vZGVsXCI7XG5pbXBvcnQgeyBEeW5hbWljUGF0aGFibGUgfSBmcm9tIFwiLi4vbWlzYy9keW5hbWljLWZvcm0tY29udHJvbC1wYXRoLm1vZGVsXCI7XG5pbXBvcnQgeyBEeW5hbWljVmFsaWRhdG9yc0NvbmZpZyB9IGZyb20gXCIuLi9taXNjL2R5bmFtaWMtZm9ybS1jb250cm9sLXZhbGlkYXRpb24ubW9kZWxcIjtcbmltcG9ydCB7IHNlcmlhbGl6YWJsZSwgc2VyaWFsaXplIH0gZnJvbSBcIi4uLy4uL2RlY29yYXRvci9zZXJpYWxpemFibGUuZGVjb3JhdG9yXCI7XG5pbXBvcnQgeyBpc0Z1bmN0aW9uLCBpc051bWJlciB9IGZyb20gXCIuLi8uLi91dGlscy9jb3JlLnV0aWxzXCI7XG5cbmV4cG9ydCBjbGFzcyBEeW5hbWljRm9ybUFycmF5R3JvdXBNb2RlbCBpbXBsZW1lbnRzIER5bmFtaWNQYXRoYWJsZSB7XG5cbiAgICAkaW1wbGljaXQ6IER5bmFtaWNGb3JtQXJyYXlHcm91cE1vZGVsO1xuICAgIGNvbnRleHQ6IER5bmFtaWNGb3JtQXJyYXlNb2RlbDtcbiAgICBAc2VyaWFsaXphYmxlKCkgZ3JvdXA6IER5bmFtaWNGb3JtTW9kZWw7XG4gICAgQHNlcmlhbGl6YWJsZSgpIGluZGV4OiBudW1iZXI7XG5cbiAgICBjb25zdHJ1Y3Rvcihjb250ZXh0OiBEeW5hbWljRm9ybUFycmF5TW9kZWwsIGdyb3VwOiBEeW5hbWljRm9ybU1vZGVsID0gW10sIGluZGV4OiBudW1iZXIgPSAtMSkge1xuXG4gICAgICAgIHRoaXMuJGltcGxpY2l0ID0gdGhpcztcbiAgICAgICAgdGhpcy5jb250ZXh0ID0gY29udGV4dDtcbiAgICAgICAgdGhpcy5ncm91cCA9IGdyb3VwO1xuICAgICAgICB0aGlzLmluZGV4ID0gaW5kZXg7XG4gICAgfVxuXG4gICAgZ2V0IHBhcmVudCgpOiBEeW5hbWljRm9ybUFycmF5TW9kZWwge1xuICAgICAgICByZXR1cm4gdGhpcy5jb250ZXh0O1xuICAgIH1cblxuICAgIGdldChpbmRleDogbnVtYmVyKTogRHluYW1pY0Zvcm1Db250cm9sTW9kZWwge1xuICAgICAgICByZXR1cm4gdGhpcy5ncm91cFtpbmRleF07XG4gICAgfVxuXG4gICAgdG9KU09OKCkge1xuICAgICAgICByZXR1cm4gc2VyaWFsaXplKHRoaXMpO1xuICAgIH1cbn1cblxuZXhwb3J0IGNvbnN0IERZTkFNSUNfRk9STV9DT05UUk9MX1RZUEVfQVJSQVkgPSBcIkFSUkFZXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgRHluYW1pY0Zvcm1BcnJheU1vZGVsQ29uZmlnIGV4dGVuZHMgRHluYW1pY0Zvcm1Db250cm9sTW9kZWxDb25maWcge1xuXG4gICAgZ3JvdXBBc3luY1ZhbGlkYXRvcnM/OiBEeW5hbWljVmFsaWRhdG9yc0NvbmZpZztcbiAgICBncm91cEZhY3Rvcnk/OiAoKSA9PiBEeW5hbWljRm9ybU1vZGVsO1xuICAgIGdyb3VwVmFsaWRhdG9ycz86IER5bmFtaWNWYWxpZGF0b3JzQ29uZmlnO1xuICAgIGdyb3Vwcz86IER5bmFtaWNGb3JtQXJyYXlHcm91cE1vZGVsW10gfCBudWxsO1xuICAgIGluaXRpYWxDb3VudD86IG51bWJlcjtcbn1cblxuZXhwb3J0IGNsYXNzIER5bmFtaWNGb3JtQXJyYXlNb2RlbCBleHRlbmRzIER5bmFtaWNGb3JtQ29udHJvbE1vZGVsIHtcblxuICAgIEBzZXJpYWxpemFibGUoKSBncm91cEFzeW5jVmFsaWRhdG9yczogRHluYW1pY1ZhbGlkYXRvcnNDb25maWcgfCBudWxsO1xuICAgIGdyb3VwRmFjdG9yeTogKCkgPT4gRHluYW1pY0Zvcm1Nb2RlbDtcbiAgICBAc2VyaWFsaXphYmxlKCkgZ3JvdXBWYWxpZGF0b3JzOiBEeW5hbWljVmFsaWRhdG9yc0NvbmZpZyB8IG51bGw7XG4gICAgQHNlcmlhbGl6YWJsZSgpIGdyb3VwczogRHluYW1pY0Zvcm1BcnJheUdyb3VwTW9kZWxbXSA9IFtdO1xuICAgIEBzZXJpYWxpemFibGUoKSBpbml0aWFsQ291bnQ6IG51bWJlcjtcblxuICAgIEBzZXJpYWxpemFibGUoKSByZWFkb25seSBncm91cFByb3RvdHlwZTogRHluYW1pY0Zvcm1Nb2RlbDsgLy8gb25seSB0byByZWNyZWF0ZSBtb2RlbCBmcm9tIEpTT05cbiAgICBAc2VyaWFsaXphYmxlKCkgcmVhZG9ubHkgdHlwZTogc3RyaW5nID0gRFlOQU1JQ19GT1JNX0NPTlRST0xfVFlQRV9BUlJBWTtcblxuICAgIGNvbnN0cnVjdG9yKGNvbmZpZzogRHluYW1pY0Zvcm1BcnJheU1vZGVsQ29uZmlnLCBsYXlvdXQ/OiBEeW5hbWljRm9ybUNvbnRyb2xMYXlvdXQpIHtcblxuICAgICAgICBzdXBlcihjb25maWcsIGxheW91dCk7XG5cbiAgICAgICAgaWYgKGlzRnVuY3Rpb24oY29uZmlnLmdyb3VwRmFjdG9yeSkpIHtcbiAgICAgICAgICAgIHRoaXMuZ3JvdXBGYWN0b3J5ID0gY29uZmlnLmdyb3VwRmFjdG9yeTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcImdyb3VwIGZhY3RvcnkgZnVuY3Rpb24gbXVzdCBiZSBzcGVjaWZpZWQgZm9yIER5bmFtaWNGb3JtQXJyYXlNb2RlbFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZ3JvdXBBc3luY1ZhbGlkYXRvcnMgPSBjb25maWcuZ3JvdXBBc3luY1ZhbGlkYXRvcnMgfHwgbnVsbDtcbiAgICAgICAgdGhpcy5ncm91cFByb3RvdHlwZSA9IHRoaXMuZ3JvdXBGYWN0b3J5KCk7XG4gICAgICAgIHRoaXMuZ3JvdXBWYWxpZGF0b3JzID0gY29uZmlnLmdyb3VwVmFsaWRhdG9ycyB8fCBudWxsO1xuICAgICAgICB0aGlzLmluaXRpYWxDb3VudCA9IGlzTnVtYmVyKGNvbmZpZy5pbml0aWFsQ291bnQpID8gY29uZmlnLmluaXRpYWxDb3VudCA6IDE7XG5cbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoY29uZmlnLmdyb3VwcykpIHtcblxuICAgICAgICAgICAgY29uZmlnLmdyb3Vwcy5mb3JFYWNoKChhcnJheUdyb3VwLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzLnB1c2gobmV3IER5bmFtaWNGb3JtQXJyYXlHcm91cE1vZGVsKHRoaXMsIGFycmF5R3JvdXAuZ3JvdXAsIGFycmF5R3JvdXAuaW5kZXggfHwgaW5kZXgpKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCB0aGlzLmluaXRpYWxDb3VudDsgaW5kZXgrKykge1xuICAgICAgICAgICAgICAgIHRoaXMuYWRkR3JvdXAoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgdXBkYXRlR3JvdXBJbmRleCgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5ncm91cHMuZm9yRWFjaCgoZ3JvdXAsIGluZGV4KSA9PiBncm91cC5pbmRleCA9IGluZGV4KTtcbiAgICB9XG5cbiAgICBnZXQgc2l6ZSgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5ncm91cHMubGVuZ3RoO1xuICAgIH1cblxuICAgIGdldChpbmRleDogbnVtYmVyKTogRHluYW1pY0Zvcm1BcnJheUdyb3VwTW9kZWwge1xuICAgICAgICByZXR1cm4gdGhpcy5ncm91cHNbaW5kZXhdO1xuICAgIH1cblxuICAgIGFkZEdyb3VwKCk6IER5bmFtaWNGb3JtQXJyYXlHcm91cE1vZGVsIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5zZXJ0R3JvdXAodGhpcy5ncm91cHMubGVuZ3RoKTtcbiAgICB9XG5cbiAgICBpbnNlcnRHcm91cChpbmRleDogbnVtYmVyKTogRHluYW1pY0Zvcm1BcnJheUdyb3VwTW9kZWwge1xuXG4gICAgICAgIGxldCBncm91cCA9IG5ldyBEeW5hbWljRm9ybUFycmF5R3JvdXBNb2RlbCh0aGlzLCB0aGlzLmdyb3VwRmFjdG9yeSgpKTtcblxuICAgICAgICB0aGlzLmdyb3Vwcy5zcGxpY2UoaW5kZXgsIDAsIGdyb3VwKTtcbiAgICAgICAgdGhpcy51cGRhdGVHcm91cEluZGV4KCk7XG5cbiAgICAgICAgcmV0dXJuIGdyb3VwO1xuICAgIH1cblxuICAgIG1vdmVHcm91cChpbmRleDogbnVtYmVyLCBzdGVwOiBudW1iZXIpOiB2b2lkIHtcblxuICAgICAgICB0aGlzLmdyb3Vwcy5zcGxpY2UoaW5kZXggKyBzdGVwLCAwLCAuLi50aGlzLmdyb3Vwcy5zcGxpY2UoaW5kZXgsIDEpKTtcbiAgICAgICAgdGhpcy51cGRhdGVHcm91cEluZGV4KCk7XG4gICAgfVxuXG4gICAgcmVtb3ZlR3JvdXAoaW5kZXg6IG51bWJlcik6IHZvaWQge1xuXG4gICAgICAgIHRoaXMuZ3JvdXBzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIHRoaXMudXBkYXRlR3JvdXBJbmRleCgpO1xuICAgIH1cblxuICAgIGNsZWFyKCk6IHZvaWQge1xuICAgICAgICB0aGlzLmdyb3Vwcy5zcGxpY2UoMCk7XG4gICAgICAgIHRoaXMudXBkYXRlR3JvdXBJbmRleCgpO1xuICAgIH1cbn1cbiJdfQ==